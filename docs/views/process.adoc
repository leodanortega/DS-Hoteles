== Vista de Proceso

Esta vista describe cómo el sistema opera durante la ejecución, enfocándose en la interacción dinámica entre los componentes, el manejo de la concurrencia y la sincronización. El objetivo es demostrar cómo se satisfacen los atributos de **Rendimiento** (tiempos de respuesta) y **Disponibilidad** (tolerancia a fallos) bajo carga.

=== Modelo de Ejecución y Concurrencia

Dado que se utiliza una arquitectura de microservicios, el modelo de ejecución base es **Thread-per-Request** (un hilo por petición).
* Cada solicitud HTTP entrante en el API Gateway o BFF asigna un hilo de procesamiento aislado.
* Para evitar el agotamiento de recursos, se implementan **Pools de Conexiones** hacia las bases de datos y **Timeouts** estrictos (Circuit Breaker) en las llamadas entre servicios (ej. `SistemaReservaciones` -> `SistemaPagos`).

A continuación, se detallan los dos procesos de negocio más críticos por su impacto en la integridad de los datos y la experiencia del usuario.

=== Flujo Crítico 1: Solicitar Reservación

Este proceso es transaccional y requiere consistencia fuerte. El sistema debe asegurar que no se vendan habitaciones indisponibles (Overbooking no controlado) y que el pago se asegure antes de confirmar.

* **Sincronización:** El flujo es orquestado de manera síncrona por el `SistemaReservaciones`.
* **Gestión de Concurrencia:** Se utiliza **Bloqueo Pesimista** (o serialización de transacciones) en el registro de la habitación durante la ventana de pago para evitar condiciones de carrera.
* **Manejo de Fallos:** Si el `SistemaPagos` no responde en 30 segundos, la transacción se aborta (Rollback) y la habitación se libera inmediatamente.

.Diagrama de Secuencia: Solicitar Reservación
image::../images/Secuencia/solicitarReservacion.png[Diagrama de Secuencia Reservación, width=800, align=center]

=== Flujo Crítico 2: Registrar Check-Out

El cierre de la estancia es crítico para la rotación del inventario. Involucra la conciliación financiera y la actualización del estado físico de la habitación para limpieza.

* **Secuencia Lógica:**
    1.  Cálculo final de consumos (Minibar, Servicios).
    2.  Cobro mandatorio del saldo pendiente.
    3.  Liberación de la habitación (Marcado como "SUCIA").
* **Integridad:** El sistema impide el Check-out si el `SistemaPagos` rechaza la transacción, evitando que el huésped se vaya con deuda (Deuda Técnica vs Deuda Financiera).
* **Actualización de Inventario:** A diferencia de la reserva, la actualización al `SistemaInventario` es el paso final y no requiere bloqueo complejo, ya que la habitación estaba ocupada por el mismo usuario.

.Diagrama de Secuencia: Registrar Check-Out
image::../images/Secuencia/registrarCheckOut.png[Diagrama de Secuencia Check-Out, width=800, align=center]